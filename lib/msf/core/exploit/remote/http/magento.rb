module Msf
  class Exploit
    class Remote
      module HTTP
        module Magento
          def initialize(info = {})
            super
          end

          # Extracts the Magento version information from the /magento_version page
          #
          # @return [Hash] Containing the keys 'version' and 'edition'
          def magento_version
            vprint_status('Trying to get the Magento version')

            # request to check if the target is vulnerable /magento_version
            res = send_request_cgi({
                                     'method' => 'GET',
                                     'uri' => normalize_uri(target_uri.path, '/magento_version')
                                   })

            return unless res&.code == 200

            # Magento/2.4 (Community)
            version, edition = res.body.scan(%r{Magento/([\d.]+) \(([^)]+)\)}).first

            version = Rex::Version.new(version)

            { 'version' => version, 'edition' => edition }
          end

        end
      end
    end
  end
end
