require 'spec_helper'

RSpec.describe Msf::Exploit::HTTP::FlaskUnsign do
  subject do
    mod = Msf::Exploit.new
    mod.extend(Msf::Exploit::HTTP::FlaskUnsign)
    mod
  end

  describe '#flask_unsign' do
    context 'correctly decodes cookie' do
      it 'returns a hash' do
        excpect(FlaskUnsign::Session.decode('eyJoZWxsbyI6IndvcmxkIn0.XDtqeQ.1qsBdjyRJLokwRzJdzXMVCSyRTA')).to eql({ 'hello' => 'world' })
      end
    end

    context 'correctly signs decoded cookie' do
      it 'returns a cookie string' do
        expect(FlaskUnsign::Session.sign({ 'hello' => 'world' }, 'CHANGEME')).to eql('eyJoZWxsbyI6IndvcmxkIn0.ZJsnXQ.iYJYiw3PkyD1D9cZy1ridAbn8w4')
      end
    end
  end
end
