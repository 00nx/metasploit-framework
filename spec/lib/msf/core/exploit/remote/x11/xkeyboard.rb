require 'spec_helper'

RSpec.describe Msf::Exploit::Remote::X11::Xkeyboard do
  subject do
    mod = ::Msf::Exploit.new
    mod.extend described_class

    mod.send(:initialize)
    mod
  end

  let(:get_keyboardmap_resp) do
    "\x01\x03\x07\x00\x47\x05\x00\x00\x00\x00\x08\xff\x07\x00\x00\x1c" \
    "\x1c\x08\x6f\x01\xf8\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08" \
    "\xf8\x0f\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00" \
    "\x01\x01\x00\x00\x02\x01\x00\x00\x01\x01\x01\x01\x00\x00\x00\x00" \
    "\x03\x03\x00\x00\x02\x02\x00\x00\x01\x01\x01\x01\x00\x00\x00\x00" \
    "\x01\x02\x01\x02\x00\x00\x00\x00\x11\x01\x01\x00\x02\x01\x00\x00" \
    "\x01\x10\x01\x00\x01\x00\x00\x00\x09\x01\x02\x00\x02\x01\x00\x00" \
    "\x01\x09\x01\x01\x02\x00\x00\x00\x40\x40\x00\x00\x02\x01\x00\x00" \
    "\x01\x40\x01\x40\x00\x00\x00\x00\x04\x04\x00\x00\x02\x01\x00\x00" \
    "\x01\x04\x01\x04\x00\x00\x00\x00\x00\x00\x40\x00\x02\x01\x00\x00" \
    "\x00\x00\x01\x00\x40\x00\x00\x00\x00\x00\x20\x00\x02\x01\x00\x00" \
    "\x00\x00\x01\x00\x20\x00\x00\x00\x08\x00\x02\x00\x02\x01\x00\x00" \
    "\x01\x08\x01\x00\x02\x00\x00\x00\x00\x00\x08\x00\x02\x01\x00\x00" \
    "\x00\x00\x01\x00\x08\x00\x00\x00\x00\x00\x10\x00\x02\x01\x00\x00" \
    "\x00\x00\x01\x00\x10\x00\x00\x00\x8d\x05\x06\x00\x05\x04\x01\x00" \
    "\x01\x01\x01\x01\x00\x00\x00\x00\x01\x80\x02\x00\x04\x00\x00\x00" \
    "\x01\x81\x03\x01\x04\x00\x00\x00\x01\x0c\x04\x04\x02\x00\x00\x00" \
    "\x01\x01\x00\x00\x00\x00\x00\x00\x01\x01\x00\x00\x00\x00\x00\x00" \
    "\x87\x07\x04\x00\x08\x0f\x00\x00\x01\x03\x00\x03\x00\x00\x00\x00" \
    "\x01\x01\x01\x01\x00\x00\x00\x00\x01\x02\x01\x02\x00\x00\x00\x00" \
    "\x01\x80\x02\x00\x04\x00\x00\x00\x01\x83\x02\x03\x04\x00\x00\x00" \
    "\x01\x81\x03\x01\x04\x00\x00\x00\x01\x82\x03\x02\x04\x00\x00\x00" \
    "\x01\x04\x04\x04\x00\x00\x00\x00\x01\x07\x04\x07\x00\x00\x00\x00" \
    "\x01\x05\x05\x05\x00\x00\x00\x00\x01\x06\x05\x06\x00\x00\x00\x00" \
    "\x01\x84\x06\x04\x04\x00\x00\x00\x01\x87\x06\x07\x04\x00\x00\x00" \
    "\x01\x85\x07\x05\x04\x00\x00\x00\x01\x86\x07\x06\x04\x00\x00\x00" \
    "\x81\x01\x04\x00\x03\x03\x00\x00\x01\x01\x01\x01\x00\x00\x00\x00" \
    "\x01\x80\x02\x00\x04\x00\x00\x00\x01\x81\x02\x01\x04\x00\x00\x00" \
    "\x81\x01\x04\x01\x08\x07\x00\x00\x01\x01\x01\x01\x00\x00\x00\x00" \
    "\x01\x80\x02\x00\x04\x00\x00\x00\x01\x81\x03\x01\x04\x00\x00\x00" \
    "\x00\x00\x04\x00\x00\x01\x00\x00\x00\x01\x05\x01\x00\x01\x00\x00" \
    "\x01\x80\x06\x00\x04\x01\x00\x00\x01\x81\x07\x01\x04\x01\x00\x00" \
    "\x83\x03\x04\x01\x08\x0d\x00\x00\x01\x01\x01\x01\x00\x00\x00\x00" \
    "\x01\x02\x01\x02\x00\x00\x00\x00\x01\x80\x02\x00\x04\x00\x00\x00" \
    "\x01\x81\x03\x01\x04\x00\x00\x00\x01\x82\x03\x02\x04\x00\x00\x00" \
    "\x01\x83\x02\x03\x04\x00\x00\x00\x00\x00\x04\x00\x00\x01\x00\x00" \
    "\x00\x01\x05\x01\x00\x01\x00\x00\x00\x02\x05\x02\x00\x01\x00\x00" \
    "\x01\x80\x06\x00\x04\x01\x00\x00\x01\x81\x07\x01\x04\x01\x00\x00" \
    "\x01\x82\x07\x02\x04\x01\x00\x00\x01\x83\x06\x03\x04\x01\x00\x00" \
    "\x93\x03\x05\x01\x08\x1c\x01\x00\x01\x01\x01\x01\x00\x00\x00\x00" \
    "\x01\x80\x02\x00\x04\x00\x00\x00\x01\x81\x03\x01\x04\x00\x00\x00" \
    "\x00\x00\x04\x00\x00\x01\x00\x00\x00\x01\x05\x01\x00\x01\x00\x00" \
    "\x01\x80\x06\x00\x04\x01\x00\x00\x01\x81\x07\x01\x04\x01\x00\x00" \
    "\x01\x10\x04\x00\x01\x00\x00\x00\x01\x11\x05\x01\x01\x00\x00\x00" \
    "\x01\x90\x06\x00\x05\x00\x00\x00\x01\x91\x07\x01\x05\x00\x00\x00" \
    "\x01\x11\x01\x01\x01\x01\x00\x00\x01\x90\x02\x00\x05\x01\x00\x00" \
    "\x01\x91\x03\x01\x05\x01\x00\x00\x01\x03\x01\x03\x00\x00\x00\x00" \
    "\x01\x82\x02\x02\x04\x00\x00\x00\x01\x83\x03\x03\x04\x00\x00\x00" \
    "\x00\x02\x04\x02\x00\x01\x00\x00\x00\x03\x05\x03\x00\x01\x00\x00" \
    "\x01\x82\x06\x02\x04\x01\x00\x00\x01\x83\x07\x03\x04\x01\x00\x00" \
    "\x01\x12\x04\x02\x01\x00\x00\x00\x01\x13\x05\x03\x01\x00\x00\x00" \
    "\x01\x92\x06\x02\x05\x00\x00\x00\x01\x93\x07\x03\x05\x00\x00\x00" \
    "\x01\x13\x01\x03\x01\x01\x00\x00\x01\x92\x02\x02\x05\x01\x00\x00" \
    "\x01\x93\x03\x03\x05\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x01\x01\x00\x00\x00\x00\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x01\x01\x00\x00\x00\x00\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x93\x03\x05\x01\x08\x1c\x01\x00" \
    "\x01\x01\x01\x01\x00\x00\x00\x00\x01\x80\x02\x00\x04\x00\x00\x00" \
    "\x01\x81\x03\x01\x04\x00\x00\x00\x00\x00\x04\x00\x00\x01\x00\x00" \
    "\x00\x01\x05\x01\x00\x01\x00\x00\x01\x80\x06\x00\x04\x01\x00\x00" \
    "\x01\x81\x07\x01\x04\x01\x00\x00\x01\x10\x04\x00\x01\x00\x00\x00" \
    "\x01\x11\x05\x01\x01\x00\x00\x00\x01\x90\x06\x00\x05\x00\x00\x00" \
    "\x01\x91\x07\x01\x05\x00\x00\x00\x01\x11\x01\x01\x01\x01\x00\x00" \
    "\x01\x90\x02\x00\x05\x01\x00\x00\x01\x91\x03\x01\x05\x01\x00\x00" \
    "\x01\x02\x01\x02\x00\x00\x00\x00\x01\x82\x02\x02\x04\x00\x00\x00" \
    "\x01\x83\x03\x03\x04\x00\x00\x00\x00\x02\x04\x02\x00\x01\x00\x00" \
    "\x00\x03\x05\x03\x00\x01\x00\x00\x01\x82\x06\x02\x04\x01\x00\x00" \
    "\x01\x83\x07\x03\x04\x01\x00\x00\x01\x12\x04\x02\x01\x00\x00\x00" \
    "\x01\x13\x05\x03\x01\x00\x00\x00\x01\x92\x06\x02\x05\x00\x00\x00" \
    "\x01\x93\x07\x03\x05\x00\x00\x00\x01\x12\x01\x02\x01\x01\x00\x00" \
    "\x01\x92\x03\x02\x05\x01\x00\x00\x01\x93\x02\x03\x05\x01\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x83\x03\x04\x01\x08\x0e\x01\x00\x01\x01\x01\x01\x00\x00\x00\x00" \
    "\x01\x02\x01\x02\x00\x00\x00\x00\x01\x80\x02\x00\x04\x00\x00\x00" \
    "\x01\x81\x03\x01\x04\x00\x00\x00\x01\x82\x02\x02\x04\x00\x00\x00" \
    "\x01\x83\x03\x03\x04\x00\x00\x00\x00\x00\x04\x00\x00\x01\x00\x00" \
    "\x00\x01\x05\x01\x00\x01\x00\x00\x00\x02\x05\x02\x00\x01\x00\x00" \
    "\x00\x03\x05\x03\x00\x01\x00\x00\x01\x80\x06\x00\x04\x01\x00\x00" \
    "\x01\x81\x07\x01\x04\x01\x00\x00\x01\x82\x06\x02\x04\x01\x00\x00" \
    "\x01\x83\x07\x03\x04\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x02\x02\x00\x00\x02\x02\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x02\x02\x00\x00\x02\x02\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x02\x02\x00\x00\x02\x02\x00\x00" \
    "\x81\x01\x04\x00\x04\x03\x00\x00\x01\x01\x01\x01\x00\x00\x00\x00" \
    "\x01\x80\x02\x00\x04\x00\x00\x00\x01\x81\x03\x01\x04\x00\x00\x00" \
    "\x83\x03\x04\x00\x04\x06\x00\x00\x01\x01\x01\x01\x00\x00\x00\x00" \
    "\x01\x02\x01\x02\x00\x00\x00\x00\x01\x80\x02\x00\x04\x00\x00\x00" \
    "\x01\x81\x03\x01\x04\x00\x00\x00\x01\x82\x03\x02\x04\x00\x00\x00" \
    "\x01\x83\x02\x03\x04\x00\x00\x00\x83\x03\x04\x00\x04\x06\x01\x00" \
    "\x01\x01\x01\x01\x00\x00\x00\x00\x01\x02\x01\x02\x00\x00\x00\x00" \
    "\x01\x80\x02\x00\x04\x00\x00\x00\x01\x81\x03\x01\x04\x00\x00\x00" \
    "\x01\x82\x02\x02\x04\x00\x00\x00\x01\x83\x03\x03\x04\x00\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x02\x02\x00\x00\x02\x02\x00\x00\x91\x01\x05\x00\x04\x07\x00\x00" \
    "\x01\x11\x00\x01\x01\x00\x00\x00\x01\x10\x01\x00\x01\x00\x00\x00" \
    "\x01\x01\x01\x01\x00\x00\x00\x00\x01\x80\x02\x00\x04\x00\x00\x00" \
    "\x01\x90\x02\x00\x05\x00\x00\x00\x01\x81\x03\x01\x04\x00\x00\x00" \
    "\x01\x91\x03\x01\x05\x00\x00\x00\x8d\x05\x06\x00\x04\x03\x00\x00" \
    "\x01\x80\x01\x00\x04\x00\x00\x00\x01\x81\x02\x01\x04\x00\x00\x00" \
    "\x01\x0c\x03\x04\x02\x00\x00\x00\x83\x03\x04\x00\x04\x06\x01\x00" \
    "\x01\x01\x01\x01\x00\x00\x00\x00\x01\x02\x03\x02\x00\x00\x00\x00" \
    "\x01\x80\x02\x00\x04\x00\x00\x00\x01\x81\x03\x01\x04\x00\x00\x00" \
    "\x01\x82\x02\x02\x04\x00\x00\x00\x01\x83\x02\x03\x04\x00\x00\x00" \
    "\x00\x00\x00\x00\x02\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x02\x02\x00\x00\x00\x00\x00\x00\x83\x03\x04\x00\x05\x07\x00\x00" \
    "\x01\x01\x01\x01\x00\x00\x00\x00\x01\x80\x02\x00\x04\x00\x00\x00" \
    "\x01\x81\x03\x01\x04\x00\x00\x00\x01\x02\x04\x02\x00\x00\x00\x00" \
    "\x01\x03\x01\x03\x00\x00\x00\x00\x01\x82\x02\x02\x04\x00\x00\x00" \
    "\x01\x83\x03\x03\x04\x00\x00\x00\x91\x01\x05\x00\x04\x06\x00\x00" \
    "\x01\x01\x01\x01\x00\x00\x00\x00\x01\x10\x01\x00\x01\x00\x00\x00" \
    "\x01\x80\x02\x00\x04\x00\x00\x00\x01\x81\x03\x01\x04\x00\x00\x00" \
    "\x01\x90\x03\x00\x05\x00\x00\x00\x01\x91\x02\x01\x05\x00\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x1b\xff\x00\x00\x01\x00\x00\x00\x01\x02\x02\x00\x31\x00\x00\x00" \
    "\x21\x00\x00\x00\x01\x00\x00\x00\x01\x02\x02\x00\x32\x00\x00\x00" \
    "\x40\x00\x00\x00\x01\x00\x00\x00\x01\x02\x02\x00\x33\x00\x00\x00" \
    "\x23\x00\x00\x00\x01\x00\x00\x00\x01\x02\x02\x00\x34\x00\x00\x00" \
    "\x24\x00\x00\x00\x01\x00\x00\x00\x01\x02\x02\x00\x35\x00\x00\x00" \
    "\x25\x00\x00\x00\x01\x00\x00\x00\x01\x02\x02\x00\x36\x00\x00\x00" \
    "\x5e\x00\x00\x00\x01\x00\x00\x00\x01\x02\x02\x00\x37\x00\x00\x00" \
    "\x26\x00\x00\x00\x01\x00\x00\x00\x01\x02\x02\x00\x38\x00\x00\x00" \
    "\x2a\x00\x00\x00\x01\x00\x00\x00\x01\x02\x02\x00\x39\x00\x00\x00" \
    "\x28\x00\x00\x00\x01\x00\x00\x00\x01\x02\x02\x00\x30\x00\x00\x00" \
    "\x29\x00\x00\x00\x01\x00\x00\x00\x01\x02\x02\x00\x2d\x00\x00\x00" \
    "\x5f\x00\x00\x00\x01\x00\x00\x00\x01\x02\x02\x00\x3d\x00\x00\x00" \
    "\x2b\x00\x00\x00\x01\x00\x00\x00\x01\x02\x02\x00\x08\xff\x00\x00" \
    "\x08\xff\x00\x00\x01\x00\x00\x00\x01\x02\x02\x00\x09\xff\x00\x00" \
    "\x20\xfe\x00\x00\x02\x00\x00\x00\x01\x02\x02\x00\x71\x00\x00\x00" \
    "\x51\x00\x00\x00\x02\x00\x00\x00\x01\x02\x02\x00\x77\x00\x00\x00" \
    "\x57\x00\x00\x00\x02\x00\x00\x00\x01\x02\x02\x00\x65\x00\x00\x00" \
    "\x45\x00\x00\x00\x02\x00\x00\x00\x01\x02\x02\x00\x72\x00\x00\x00" \
    "\x52\x00\x00\x00\x02\x00\x00\x00\x01\x02\x02\x00\x74\x00\x00\x00" \
    "\x54\x00\x00\x00\x02\x00\x00\x00\x01\x02\x02\x00\x79\x00\x00\x00" \
    "\x59\x00\x00\x00\x02\x00\x00\x00\x01\x02\x02\x00\x75\x00\x00\x00" \
    "\x55\x00\x00\x00\x02\x00\x00\x00\x01\x02\x02\x00\x69\x00\x00\x00" \
    "\x49\x00\x00\x00\x02\x00\x00\x00\x01\x02\x02\x00\x6f\x00\x00\x00" \
    "\x4f\x00\x00\x00\x02\x00\x00\x00\x01\x02\x02\x00\x70\x00\x00\x00" \
    "\x50\x00\x00\x00\x01\x00\x00\x00\x01\x02\x02\x00\x5b\x00\x00\x00" \
    "\x7b\x00\x00\x00\x01\x00\x00\x00\x01\x02\x02\x00\x5d\x00\x00\x00" \
    "\x7d\x00\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00\x0d\xff\x00\x00" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\xe3\xff\x00\x00\x02\x00\x00\x00" \
    "\x01\x02\x02\x00\x61\x00\x00\x00\x41\x00\x00\x00\x02\x00\x00\x00" \
    "\x01\x02\x02\x00\x73\x00\x00\x00\x53\x00\x00\x00\x02\x00\x00\x00" \
    "\x01\x02\x02\x00\x64\x00\x00\x00\x44\x00\x00\x00\x02\x00\x00\x00" \
    "\x01\x02\x02\x00\x66\x00\x00\x00\x46\x00\x00\x00\x02\x00\x00\x00" \
    "\x01\x02\x02\x00\x67\x00\x00\x00\x47\x00\x00\x00\x02\x00\x00\x00" \
    "\x01\x02\x02\x00\x68\x00\x00\x00\x48\x00\x00\x00\x02\x00\x00\x00" \
    "\x01\x02\x02\x00\x6a\x00\x00\x00\x4a\x00\x00\x00\x02\x00\x00\x00" \
    "\x01\x02\x02\x00\x6b\x00\x00\x00\x4b\x00\x00\x00\x02\x00\x00\x00" \
    "\x01\x02\x02\x00\x6c\x00\x00\x00\x4c\x00\x00\x00\x01\x00\x00\x00" \
    "\x01\x02\x02\x00\x3b\x00\x00\x00\x3a\x00\x00\x00\x01\x00\x00\x00" \
    "\x01\x02\x02\x00\x27\x00\x00\x00\x22\x00\x00\x00\x01\x00\x00\x00" \
    "\x01\x02\x02\x00\x60\x00\x00\x00\x7e\x00\x00\x00\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\xe1\xff\x00\x00\x01\x00\x00\x00\x01\x02\x02\x00" \
    "\x5c\x00\x00\x00\x7c\x00\x00\x00\x02\x00\x00\x00\x01\x02\x02\x00" \
    "\x7a\x00\x00\x00\x5a\x00\x00\x00\x02\x00\x00\x00\x01\x02\x02\x00" \
    "\x78\x00\x00\x00\x58\x00\x00\x00\x02\x00\x00\x00\x01\x02\x02\x00" \
    "\x63\x00\x00\x00\x43\x00\x00\x00\x02\x00\x00\x00\x01\x02\x02\x00" \
    "\x76\x00\x00\x00\x56\x00\x00\x00\x02\x00\x00\x00\x01\x02\x02\x00" \
    "\x62\x00\x00\x00\x42\x00\x00\x00\x02\x00\x00\x00\x01\x02\x02\x00" \
    "\x6e\x00\x00\x00\x4e\x00\x00\x00\x02\x00\x00\x00\x01\x02\x02\x00" \
    "\x6d\x00\x00\x00\x4d\x00\x00\x00\x01\x00\x00\x00\x01\x02\x02\x00" \
    "\x2c\x00\x00\x00\x3c\x00\x00\x00\x01\x00\x00\x00\x01\x02\x02\x00" \
    "\x2e\x00\x00\x00\x3e\x00\x00\x00\x01\x00\x00\x00\x01\x02\x02\x00" \
    "\x2f\x00\x00\x00\x3f\x00\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\xe2\xff\x00\x00\x0c\x00\x00\x00\x01\x05\x05\x00\xaa\xff\x00\x00" \
    "\xaa\xff\x00\x00\xaa\xff\x00\x00\xaa\xff\x00\x00\x21\xfe\x08\x10" \
    "\x01\x00\x00\x00\x01\x02\x02\x00\xe9\xff\x00\x00\xe7\xff\x00\x00" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x20\x00\x00\x00\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\xe5\xff\x00\x00\x0c\x00\x00\x00\x01\x05\x05\x00" \
    "\xbe\xff\x00\x00\xbe\xff\x00\x00\xbe\xff\x00\x00\xbe\xff\x00\x00" \
    "\x01\xfe\x08\x10\x0c\x00\x00\x00\x01\x05\x05\x00\xbf\xff\x00\x00" \
    "\xbf\xff\x00\x00\xbf\xff\x00\x00\xbf\xff\x00\x00\x02\xfe\x08\x10" \
    "\x0c\x00\x00\x00\x01\x05\x05\x00\xc0\xff\x00\x00\xc0\xff\x00\x00" \
    "\xc0\xff\x00\x00\xc0\xff\x00\x00\x03\xfe\x08\x10\x0c\x00\x00\x00" \
    "\x01\x05\x05\x00\xc1\xff\x00\x00\xc1\xff\x00\x00\xc1\xff\x00\x00" \
    "\xc1\xff\x00\x00\x04\xfe\x08\x10\x0c\x00\x00\x00\x01\x05\x05\x00" \
    "\xc2\xff\x00\x00\xc2\xff\x00\x00\xc2\xff\x00\x00\xc2\xff\x00\x00" \
    "\x05\xfe\x08\x10\x0c\x00\x00\x00\x01\x05\x05\x00\xc3\xff\x00\x00" \
    "\xc3\xff\x00\x00\xc3\xff\x00\x00\xc3\xff\x00\x00\x06\xfe\x08\x10" \
    "\x0c\x00\x00\x00\x01\x05\x05\x00\xc4\xff\x00\x00\xc4\xff\x00\x00" \
    "\xc4\xff\x00\x00\xc4\xff\x00\x00\x07\xfe\x08\x10\x0c\x00\x00\x00" \
    "\x01\x05\x05\x00\xc5\xff\x00\x00\xc5\xff\x00\x00\xc5\xff\x00\x00" \
    "\xc5\xff\x00\x00\x08\xfe\x08\x10\x0c\x00\x00\x00\x01\x05\x05\x00" \
    "\xc6\xff\x00\x00\xc6\xff\x00\x00\xc6\xff\x00\x00\xc6\xff\x00\x00" \
    "\x09\xfe\x08\x10\x0c\x00\x00\x00\x01\x05\x05\x00\xc7\xff\x00\x00" \
    "\xc7\xff\x00\x00\xc7\xff\x00\x00\xc7\xff\x00\x00\x0a\xfe\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x7f\xff\x00\x00\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x14\xff\x00\x00\x03\x00\x00\x00\x01\x02\x02\x00" \
    "\x95\xff\x00\x00\xb7\xff\x00\x00\x03\x00\x00\x00\x01\x02\x02\x00" \
    "\x97\xff\x00\x00\xb8\xff\x00\x00\x03\x00\x00\x00\x01\x02\x02\x00" \
    "\x9a\xff\x00\x00\xb9\xff\x00\x00\x0c\x00\x00\x00\x01\x05\x05\x00" \
    "\xad\xff\x00\x00\xad\xff\x00\x00\xad\xff\x00\x00\xad\xff\x00\x00" \
    "\x23\xfe\x08\x10\x03\x00\x00\x00\x01\x02\x02\x00\x96\xff\x00\x00" \
    "\xb4\xff\x00\x00\x03\x00\x00\x00\x01\x02\x02\x00\x9d\xff\x00\x00" \
    "\xb5\xff\x00\x00\x03\x00\x00\x00\x01\x02\x02\x00\x98\xff\x00\x00" \
    "\xb6\xff\x00\x00\x0c\x00\x00\x00\x01\x05\x05\x00\xab\xff\x00\x00" \
    "\xab\xff\x00\x00\xab\xff\x00\x00\xab\xff\x00\x00\x22\xfe\x08\x10" \
    "\x03\x00\x00\x00\x01\x02\x02\x00\x9c\xff\x00\x00\xb1\xff\x00\x00" \
    "\x03\x00\x00\x00\x01\x02\x02\x00\x99\xff\x00\x00\xb2\xff\x00\x00" \
    "\x03\x00\x00\x00\x01\x02\x02\x00\x9b\xff\x00\x00\xb3\xff\x00\x00" \
    "\x03\x00\x00\x00\x01\x02\x02\x00\x9e\xff\x00\x00\xb0\xff\x00\x00" \
    "\x03\x00\x00\x00\x01\x02\x02\x00\x9f\xff\x00\x00\xae\xff\x00\x00" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x03\xfe\x00\x00\x00\x00\x00\x00" \
    "\x00\x00\x00\x00\x14\x00\x00\x00\x01\x04\x04\x00\x3c\x00\x00\x00" \
    "\x3e\x00\x00\x00\x7c\x00\x00\x00\xa6\x00\x00\x00\x0c\x00\x00\x00" \
    "\x01\x05\x05\x00\xc8\xff\x00\x00\xc8\xff\x00\x00\xc8\xff\x00\x00" \
    "\xc8\xff\x00\x00\x0b\xfe\x08\x10\x0c\x00\x00\x00\x01\x05\x05\x00" \
    "\xc9\xff\x00\x00\xc9\xff\x00\x00\xc9\xff\x00\x00\xc9\xff\x00\x00" \
    "\x0c\xfe\x08\x10\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x26\xff\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x25\xff\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00\x23\xff\x00\x00" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x27\xff\x00\x00\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x22\xff\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x8d\xff\x00\x00\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\xe4\xff\x00\x00\x0c\x00\x00\x00\x01\x05\x05\x00" \
    "\xaf\xff\x00\x00\xaf\xff\x00\x00\xaf\xff\x00\x00\xaf\xff\x00\x00" \
    "\x20\xfe\x08\x10\x09\x00\x00\x00\x01\x02\x02\x00\x61\xff\x00\x00" \
    "\x15\xff\x00\x00\x01\x00\x00\x00\x01\x02\x02\x00\xea\xff\x00\x00" \
    "\xe8\xff\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00\x0a\xff\x00\x00" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x50\xff\x00\x00\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x52\xff\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x55\xff\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00\x51\xff\x00\x00" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x53\xff\x00\x00\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x57\xff\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x54\xff\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00\x56\xff\x00\x00" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x63\xff\x00\x00\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\xff\xff\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x12\xff\x08\x10\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x11\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x13\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00\x2a\xff\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\xbd\xff\x00\x00\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\xb1\x00\x00\x00\x06\x00\x00\x00\x01\x02\x02\x00" \
    "\x13\xff\x00\x00\x6b\xff\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x4a\xff\x08\x10\x03\x00\x00\x00\x01\x02\x02\x00\xae\xff\x00\x00" \
    "\xae\xff\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00\x31\xff\x00\x00" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x34\xff\x00\x00\x00\x00\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00\xeb\xff\x00\x00" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\xec\xff\x00\x00\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x67\xff\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x69\xff\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00\x66\xff\x00\x00" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x70\xff\x05\x10\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x65\xff\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x71\xff\x05\x10\x00\x00\x00\x00\x01\x01\x01\x00\x57\xff\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x6b\xff\x08\x10\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x6d\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x68\xff\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00\x58\xff\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x6a\xff\x00\x00\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x65\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x1d\xff\x08\x10\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x2f\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x2b\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00\x5d\xff\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x7b\xff\x08\x10\x00\x00\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00\x8a\xff\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x41\xff\x08\x10\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x42\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x2e\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00\x5a\xff\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x2d\xff\x08\x10\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x74\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x7f\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00\x19\xff\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x30\xff\x08\x10\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x33\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x26\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00\x27\xff\x08\x10" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x2c\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00\x2c\xff\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x17\xff\x08\x10\x01\x00\x00\x00" \
    "\x01\x02\x02\x00\x14\xff\x08\x10\x31\xff\x08\x10\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x16\xff\x08\x10\x01\x00\x00\x00\x01\x02\x02\x00" \
    "\x15\xff\x08\x10\x2c\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x1c\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00\x3e\xff\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x6e\xff\x08\x10\x00\x00\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00\x81\xff\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x18\xff\x08\x10\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x73\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x56\xff\x08\x10\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00\x78\xff\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x79\xff\x08\x10\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x28\x00\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x29\x00\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00\x68\xff\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x66\xff\x00\x00\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x81\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x45\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00\x46\xff\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x47\xff\x08\x10\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x48\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x49\xff\x08\x10\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\xb2\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\xa9\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00\xb0\xff\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\xb1\xff\x08\x10\x00\x00\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00\x7e\xff\x00\x00" \
    "\x01\x00\x00\x00\x01\x02\x02\x00\x00\x00\x00\x00\xe9\xff\x00\x00" \
    "\x01\x00\x00\x00\x01\x02\x02\x00\x00\x00\x00\x00\xe7\xff\x00\x00" \
    "\x01\x00\x00\x00\x01\x02\x02\x00\x00\x00\x00\x00\xeb\xff\x00\x00" \
    "\x01\x00\x00\x00\x01\x02\x02\x00\x00\x00\x00\x00\xed\xff\x00\x00" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x14\xff\x08\x10\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x31\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x43\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00\x44\xff\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x4b\xff\x08\x10\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\xa7\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x56\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00\x14\xff\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x97\xff\x08\x10\x00\x00\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00\x61\xff\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x8f\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00\xb6\xff\x08\x10" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x19\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00\x8e\xff\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x1b\xff\x08\x10\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x5f\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x3c\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00\x5e\xff\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x36\xff\x08\x10\x00\x00\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00\x69\xff\x00\x00" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x03\xff\x08\x10\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x02\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x32\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00\x59\xff\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x04\xff\x08\x10\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x06\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x05\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00\x7b\xff\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x72\xff\x08\x10\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x90\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x77\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00\x5b\xff\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x93\xff\x08\x10\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\x94\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x95\xff\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00\x96\xff\x08\x10" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\x22\xfe\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00\x23\xfe\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\x07\xff\x08\x10\x00\x00\x00\x00" \
    "\x01\x01\x01\x00\xf4\x10\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00" \
    "\xf5\x10\x08\x10\x00\x00\x00\x00\x01\x01\x01\x00\xb4\xff\x08\x10" \
    "\x00\x00\x00\x00\x01\x01\x01\x00\xb5\xff\x08\x10\x25\x04\x32\x01" \
    "\x3e\x01\x40\x08\x42\x02\x4d\x10\x5c\x80\x69\x04\x6c\x08\x85\x40" \
    "\x86\x40\xcb\x80\xcd\x08\xce\x40\xcf\x40\x00\x00"
  end

  let(:get_querykeymap_resp) do
    "\x01\x00\x0f\x25\x02\x00\x00\x00\x00\x04\x00\x00\x00\x00\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x00\x00\x00\x00\x00\x00\x00\x00"
  end

  let(:keyboard_select_events_new_keyboard_notify) do
    "\x88\x01\x05\x00\x03\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    "\x05\x00\x05\x00"
  end

  let(:keyboard_select_events_map_notify) do
    "\x88\x01\x04\x00\x03\x00\x02\x00\x00\x00\x00\x00\x07\x00\x07\x00"
  end

  describe 'handles xkeyboard GetMap response' do
    it do
      response = Msf::Exploit::Remote::X11::Xkeyboard::X11XKEYBOARDGETMAPREPLY.read(get_keyboardmap_resp)
      expect(response.min_key_code).to eq(8)
      expect(response.max_key_code).to eq(255)

      expect(response.n_types).to eq(28)
      expect(response.key_types_array.length).to eq(28)
      # spot check a few of the key_types_array items
      expect(response.key_types_array[12].mods_mask).to eq(141)
      expect(response.key_types_array[12].key_map_array.length).to eq(4)
      expect(response.key_types_array[12].key_mods_array.length).to eq(4)
      expect(response.key_types_array[13].mods_mask).to eq(135)
      expect(response.key_types_array[13].key_map_array.length).to eq(15)

      expect(response.n_key_sym).to eq(248)
      # spot check a few of the key_map_array items
      expect(response.key_map_array[247].key_sym_array[0].syms).to eq(269025205)

      expect(response.total_mod_map_key).to eq(15)
      # spot check a few of the key_mod_map_array items
      expect(response.key_mod_map_array[0].keycode).to eq(37)
      expect(response.key_mod_map_array[0].mods).to eq(4)
      expect(response.key_mod_map_array[14].keycode).to eq(207)
      expect(response.key_mod_map_array[14].mods).to eq(64)
    end
  end

  describe 'handles QueryKeymap response' do
    it do
      response = Msf::Exploit::Remote::X11::Xkeyboard::X11QUERYKEYMAPREPLY.read(get_querykeymap_resp)
      expect(response.reply).to eq(1)
      expect(response.sequence_number).to eq(9487)
      expect(response.reply_length).to eq(2)
      # XXX commenting out because other things need fixing right now
      # expect(response.data).to eq("\x00\x04\x00\x00\x00\x00\x00\x00" \
      # "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
      # "\x00\x00\x00\x00\x00\x00\x00\x00")
    end
  end

  describe 'creates new keyboard notify request' do
    it do
      response = Msf::Exploit::Remote::X11::Xkeyboard::X11SELECTEVENTS.read(keyboard_select_events_new_keyboard_notify)
      puts response
      expect(response.xkeyboard_id).to eq(136)
      expect(response.extension_minor).to eq(1)
      expect(response.request_length).to eq(5)
      expect(response.device_spec).to eq(3)
      expect(response.affect_which_new_keyboard_notify).to eq(1)
      expect(response.affect_new_keyboard_key_codes).to eq(1)
      expect(response.affect_new_keyboard_device_id).to eq(1)
    end
  end

  describe 'creates map notify request' do
    it do
      response = Msf::Exploit::Remote::X11::Xkeyboard::X11SELECTEVENTS.read(keyboard_select_events_map_notify)
      expect(response.xkeyboard_id).to eq(136)
      expect(response.extension_minor).to eq(1)
      expect(response.request_length).to eq(4)
      expect(response.device_spec).to eq(3)
      expect(response.affect_which_map_notify).to eq(1)
      expect(response.map_key_types).to eq(1)
      expect(response.map_key_syms).to eq(1)
      expect(response.map_modifier_map).to eq(1)
    end
  end
end